```
##
TFX
duanxz
20210602 10:55
```

## 掘金

有回测平台可以直接用

![](https://pic1.zhimg.com/80/v2-967fde7334dde927265cd963374832ec_720w.png)

实例：(日内交易-skypark为例进行)

[量化策略系列教程：08空中花园策略（SkyPark)](https://zhuanlan.zhihu.com/p/28113146)



## 四类高频

1. 订单拆分

   **使用多种算法把大订单分割成若干个小订单，从而减小大订单对市场的影响并降低执行成本。**

   这类算法可以分为三代。

   第一代主要考虑如何减小对市场的影响，以TWAP(time weighted average  price)、VWAP(volume weightedaverage price)和POV(percent of  volume)为代表。其中，TWAP将大订单在规定的时间内按照一定的交易频率分割成小订单，VWAP按照交易量的历史分布分割订单，POV则将小订单以固定比例混入订单流以降低对市场的影响。但是，这种有规律的订单分割方式容易被其他交易者发觉并跟风，从而提高交易成本。

   第二代拆分策略则加入了一些反侦测的技术手段。例如冰山策略(iceberg)采取了随机分割的方法，最低影响(minimal impact)策略则是利用备选交易系统2作为主要的交易通道，而只把小部分交易放在公开的交易系统中完成，以避免交易意图的泄露。

   第三代拆分策略认为，如果片面地强调订单分割和避免被侦测，就存在无法按时完成交易计划的风险，这样反而会导致交易成本的上升，因此强调利用交易量较大的交易时间完成仓位计划。而且，为了使执行差额策略可以适应快速变化的市场条件，Kissell,Freyre-Sanders and Carrie提出了适应性差额策略(adaptiveshortfall)，以根据当前价格的变动情况决定如何执行仓位计划。

2. 做市交易策略

   **在美国，所有的证券交易所都为那些创造流动性的券商提供一定的交易费用回扣以争取更多的交易订单**。当这些交易者使用双向挂单等待成交时，便为市场提供了流动性，使得其他有交易需求的交易者以更低的成本交易，相应的也提高了交易所的竞争力。

3. 定量化交易策略

   定量化交易策略种类非常繁多，有的针对单一资产，有的则针对投资组合。**针对单一资产的分析方法包括事件套利(event arbitrage)、盘口交易(ticker tape trading)和技术分析(technicaltrading)等。**

   事件套利是指针对某特定事件的发生(如重组、拆分、兼并、收购等等)预先判定其对市场影响，进而利用市场的短期新闻效应进行交易。盘口交易是指根据订单流、交易量等信息进行交易的策略。有研究认为，价格序列和交易量中包含了尚未公布的信息，通过对其进行分析，就可以根据这些信息进行交易。技术分析利用历史价格的走势和图形预测价格波动。Park and Irwin发现新兴股票市场、期货以及外汇市场是最适合技术分析的市场。Lukac,Brorsen and  Irwin认为所有技术分析手段中趋势追随型交易策略最为有效Murphy指出，实现趋势追随的主要方法是移动均线法和通道突破法。

   **针对投资组合的交易策略包括套利交易(arbitrage)和配对交易(pairtrading)等。**

   套利交易通过捕捉标的物完全相同的两种金融资产的差价获取利润。美国市场金融产品品种较多，针对同一标的物可能同时有期权期货等多种金融产品；同时，每种资产又可以同时在几个交易所挂牌交易。这样的市场生态为套利交易提供了较大的生存空间。

   配对交易也称收敛交易(convergence  trading)，它假设相关联的标的物的价格具有相关性，因此在一种资产价格上涨而另一种下跌时，就可以做多下跌的资产，而卖空上涨的资产。由配对交易发展而来的统计套利(statistical  arbitrage)与配对交易的不同之处在于，统计套利判断资产的相关性并不依据基本面或其市场特征，而且它所关注的往往是包括上百个资产的资产组合之间统计上的相关性。

   

4. 其他策略

   除了上述正常的交易策略，还有一些高频交易策略可以使交易者获取信息优势而损害交易的公平性，甚至操纵价格走势，**主要包括结构性(structural)策略和方向性(directional)策略。**

   结构性策略是指交易者利用不公平的交易制度获利。例如，某些交易者可能利用托管服务(co-location)先于其他交易者获取价格和订单数据，并据此下单而获利。

   方向性策略主要包括指令占先(order anticipation)策略和趋势引发(momentum  ignition)策略。指令占先策略在某些文献中又被称为“掠夺性算法交易”，它是指通过技术手段识别潜在大买(卖)方并抢先发出指令，待其大笔交易引发价格上升(下降)后平仓获利。

   趋势引发策略是指事先建立头寸，然后诱骗其他交易者进行交易引发价格快速变动，进而从中牟利。其具体操作方法主要包括：通过大量挂单诱导其他交易者跟风；通过大笔成交触发市场中存在的止损指令；等等。在进行交易操纵的同时，还可能伴随着发布虚假信息等行为。



## 实盘交易代码的常见bug

1. 少写一个return，疯狂开平2900次，以爆仓结束.

2. 在上生产环境前，不小心误删除了一个“！”（我至今也不清楚为什么会误删了，晕），导致平仓逻辑一直不满足，不止损，让我损失惨重！

3. 卖单变买单.

4. 有个回调里的参数修改少了小数点，然后以光速来回 hit bid-ask.**什么是外汇买入价（BID）与卖出价（OFFER或ASK）**

5. 重要代码在模拟环境上先跑个半年再上线.

6. 大多都是写的没风控模块的bug ，我是正好相反，之前是一个长期cta交易策略，把风控配置文件直接拷贝到新服务器里，然后忘记改了，以至于一个短频交易的策略被风控卡主不能发平仓单，然后拿到收盘亏了钱，一看风控提示当天下的单过多不让发单了.

7. 好多年前某行一个交易员下单打反qty(quantity)和price，于是公司输掉了全年利润.

8. 某人的东西没有最大仓位控制，一小时内买了200张future的货还TM不带hedge.

9. 某策略不带参数交叉检查，做了一天以为自己赚了很多，结果仔细一看输了很多.

10. 以前听说过的一个真实案例，某公司equity arb desk(**从事于套利或套汇之人（arbitrageur，非正式）**)，有一个自动hedge程序，在盘尾的时候自动调整仓位保证beta neutral。结果某次升级的时候，把hedging instrument（可能就是SPY）的价格弄错了。结果一下单就把beta平衡弄过头了，然后反向又下单，又弄过了，就这么来回的撸了不知道多少遍，一天亏了10%，全亏在手续费和bid-ask上.

11. 规则生成、节假日、新合约，看上去就是个概率bug.

12. 有些团队喜欢省钱，就不买市场日历的api了，自己动手写一个爬虫，从yahoo finance上抓股票的财务数据发布、股东会日期等数据.

13. 数据源断了一半.

14. FIX夏令时.(**Daylight Saving Time：DST，又称“日光节约时制”和“夏令时间”，在这一制度实行期间所采用的统一时间称为“夏令时间”。一般在天亮早的夏季人为将时间调快一小时，可以使人早起早睡，减少照明量，以充分利用光照资源，从而节约照明用电。**)

15. 断线重发指令：FIX连上了，发送第一个交易指令，开始等待-->这时网络断了，没收到确认回执-->等待超时，心跳还没超时-->重发交易指令，却错误地用了新的订单号，网络是好的.

16. 期货交易所突然提高交易保证金，账户是割裂的，一个账户资金充足可以开仓，一个资金不够开不了仓.

17. 爬虫读取的本地2017年日期csv文件，没有更新到2018年日期，出错.



## 量化黑箱子

1. 提出一个交易思路“市值超过10亿就剔除”的小市值轮动、或者是“只选择分红最多最勤”的红利企业思路，或者是多因子，或者是什么“只炒次新”，总之你要先有个想法。


2. 变成一个策略

   想法是好的，但是想当然就不好了。当你通过一些开放、易得的数据对你的想法进行验证时，发现3年翻倍哟。在量化领域，一个成功的选股策略称为“因子”，而要实现稳定的盈利，你需要有较大的、高质量的“因子库”来支持。

3. 搭建一个量化模型

   这才是真正的量化核心，关于这一部分就不多做介绍了，但是顾名思义还是可以理解的，并且三者要达到一个动态平衡，就是你既要追求高利润、还要限制风险，还要降低交易成本。

4. 让机器跑起来

   当量化模型建议后，你就获得了一个最优目标组合，然后让机器来交易吧

5. 完事了吗

   是不是交给机器就可以了？不，你依然需要时刻盯着模型，因为魔鬼在细节里。机器的理解能力依然无法达到人脑的程度。比如，你的策略里有一个限定条件，当某只股票当日涨停后卖出获利。但是，如果这个股票是因为重组停牌，是有可能连续涨停的，这个时候就需要人为干预，通过修正参数和调整策略来让模型更好的获利。而不是在第一个涨停板就跑掉。



## 模型

### Fama-French 三因子

多因子模型，考虑以下三个因子，另含时间函数做漂移项：

* 市场因子：可以是中证500收益率-shibor；
* 规模（市值）因子：表示由公司规模不同造成的风险溢价，可以对空间内所有标的根据市值分组，然后找组间收益差；
* 账面市值比因子：表示由于账面市值比不同造成的风险溢价，可对标的根据（1/pb）分组，然后找组间收益差；

## 股票为例的选股思路

1. 将收益率为目标离散化，定义哑变量label；
2. 将pb，pe等等指标作为协变量，标准化后作为因子；
3. svm，LogisticRegression，GridSearchCV（网格搜索，拆分为两部分，GridSearch和CV，即网格搜索和交叉验证），

结果：好像svm和网格搜索都是中途处理特征的，核心函数就是逻辑回归，结果就是将前后30%分别label列为**正负一**，预判多空方向；